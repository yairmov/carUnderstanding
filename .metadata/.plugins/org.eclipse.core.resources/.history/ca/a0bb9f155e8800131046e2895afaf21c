'''
Util functions for the carUnderstanding projects
Created on Jan 28, 2014

@author: yair@cs.cmu.edu
'''

import pandas as pd
import os
import cv2 as cv
import scipy.misc


def set_width_to_normalize_bb(img, xmin, xmax, to_width):
  w = xmax - xmin
  s = to_width / w
  return scipy.misc.imresize(img, s), s

'''
This will change the images in the dataset!!
Call this on a COPY of the dataset
'''
def normalize_dataset(dataset, config):
  for row_tuple in dataset.iterrows():
    # row_tuple[0]=index row_tuple[1]=data
    row = row_tuple[1]
    rel_path = row['rel_path']
    img_file = os.path.join(config.dataset.main_path, rel_path)

    # Read image and resize such that bounding box is of specific size
    print 'Resize img such that BB is of width = ' + str(config.bb_width)
    img = cv.imread(img_file)
    img, scaler = set_width_to_normalize_bb(img, row['xmin'], 
                                    row['xmax'], config.bb_width)
    cv.imwrite(img, img_file)
    
    # change xmin, xmax, ymin, ymax to the new size
